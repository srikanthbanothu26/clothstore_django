<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Runway Shirts</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="text-left text-xs font-medium text-gray-500  tracking-wider">
    <div class="grid grid-cols-2">
      <div class="w-3/4 mx-auto">
        <h2 class="text-xl font-semibold ">Your Addresses</h2>
        {%if addresses%}
        <div>
        {% for address in addresses %}
          <div class="border border-gray-200  p-4 ps-4  grid items-center">
            <label for="address-{{ forloop.counter }}" class="grid grid-cols-4 items-center">
              <div class="grid col-span-3">
                <div class="flex h-5 items-center">
                  <input id="address-{{ forloop.counter }}" aria-describedby="address-{{ forloop.counter }}-text" type="radio" name="payment-method" value="{{ address.id }}" class="h-4 w-4 border-gray-300  "
                    {% if forloop.first %}checked{% endif %}/>
                </div>
                <div class="ms-4 text-sm">
                  <h1 class="font-medium  ">{{ address.first_name }}</h1>
                  <p id="address-{{ forloop.counter }}-text" class="mt-1 text-xs font-normal">{{ address.address }}, {{ address.city }}, {{ address.state }}, {{ address.pincode }}<br>Phone: {{ address.mobile }}</p>
                </div>
              </div>
              <a href="{% url 'Delete-Address' address.id%}" class="text-red-600 border-2 border-gray-200 p-2" >remove address</a>
            </label>
          </div>
          {% endfor %}
        </div>
        {%else%}
        <p>addresses not found, please add address</p>
        {%endif%}
      </div>
      
      <div class="mt-10 grid grid-cols-1">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
              <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shirt Name</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount Price</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preview Image</th>
              </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
              {% for x in cart %}
              <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ x.user }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ x.shirt.name }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ x.shirt.discountPrice }}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                      <img src="{{ x.shirt.previewImage.url }}" class="h-20 w-20">
                  </td>
              </tr>
              {% endfor %}
              <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" colspan="2">Total</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ total_discount_price }}</td>
                  <td class="px-6 py-4 whitespace-nowrap"></td>
              </tr>
          </tbody>
        </table>
      </div>
     
  </div>
  <div class="grid grid-cols-2">
    <form id="address-form" class="mx-auto w-3/4 px-4">
        <h2 class="text-xl font-semibold ">Delivery Details</h2>
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label for="your_name" class="mb-2 block text-sm font-medium ">
              Your name
            </label>
            <input
              type="text"
              id="your_name"
              name="first_name"
              class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm  focus:border-primary-500 focus:ring-primary-500"
              placeholder="Bonnie Green"
              required
            />
          </div>
              <div>
                <label for="your_email" class="mb-2 block text-sm font-medium ">
                  Your email*
                </label>
                <input
                  type="email"
                  id="your_email"
                  name="email"
                  class="block w-full rounded-lg border border-gray-300 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 "
                  placeholder="name@flowbite.com"
                  required
                />
              </div>
              <div>
                <div class="mb-2 flex items-center gap-2">
                  <label for="select-state-input-3" class="block text-sm font-medium text-gray-900 ">
                    State*
                  </label>
                </div>
                <select
                  id="select-state-input-3"
                  name="state"
                  class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 ">
                  <option value="">Select State</option>
                  <option value="AS">Australia</option>
                  <option value="FR">France</option>
                  <option value="ES">Spain</option>
                  <option value="UK">United Kingdom</option>
                </select>
              </div>
              <div>
                <div class="mb-2 flex items-center gap-2">
                  <label for="select-city-input-3" class="block text-sm font-medium ">
                    City*
                  </label>
                </div>
                <select
                  id="select-city-input-3"
                  name="city"
                  class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900  "
                >
                  <option value="">Select City</option>
                  <option value="San Francisco">San Francisco</option>
                  <option value="New York">New York</option>
                  <option value="Los Angeles">Los Angeles</option>
                  <option value="Chicago">Chicago</option>
                  <option value="Houston">Houston</option>
                </select>
              </div>
              <div class="col-span-2">
                <label for="address" class="mb-2 block text-sm font-medium ">
                  Address*
                </label>
                <textarea
                  id="address"
                  name="address"
                  class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 "
                  required
                ></textarea>
              </div>
              <div>
                <label for="pincode" class="mb-2 block text-sm font-medium ">
                  Zip*
                </label>
                <input
                  type="text"
                  id="pincode"
                  name="zip"
                  class="block w-full rounded-lg border border-gray-300  p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 "
                  placeholder="000000"
                  required
                />
              </div>
              <div>
                <label for="phone-input-3" class="mb-2 block text-sm font-medium">
                  Phone Number*
                </label>
              <div class="flex items-center">
                <select id="phone-input-3" class="mr-2 flex-shrink-0 rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 ">
                    <option>IN</option>
                    <option>US</option>
                    <option>CA</option>
                    <option>FR</option>
                </select>
                <input
                type="tel"
                id="phone-input-3"
                name="phone"
                class="block w-full rounded-lg border border-gray-300  p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500 "
                placeholder="xxx-xxx-xxxx"
                />
              </div>
          </div>
      </div>

    </form>
  </div>

  <div class="mt-6 grid grid-cols-2 mb-10">
    <div class="w-3/4 mx-auto ">
      <button
        type="submit"
        class="w-full rounded-lg  px-4 py-2 text-sm font-medium  shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2  border border-2 "
        onclick="addNewAddress()"
      >
        Add Address
      </button>
    </div>
    <div>
    </div>
  </div>
  
</body>
<script>
  async function addNewAddress() {
    const formElement = document.getElementById("address-form");
    const formData = new FormData(formElement);
    const csrfToken = '{{ csrf_token }}';
    
    const response = await fetch("{% url 'Add_Address' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": csrfToken,
        "Accept": "application/json",
      },
      body: formData,
    });
    
    const data = await response.json();
    if (data.success) {
      alert(data.message);
      formElement.reset();
      window.location.href = data.redirect_url; // Redirect to the checkout page
    } else {
      alert(data.message);
    }
  }
</script>
</html>
